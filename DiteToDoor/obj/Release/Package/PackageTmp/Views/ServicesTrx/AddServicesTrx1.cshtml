

@using DataMapping.Entites
@model DataMapping.ViewModel.ServicesTrxViewModel
@{

    <style>
        #Serial {
            border: 2px solid #d1d1d1;
        }

        #PreviousReading {
            border: 2px solid #d1d1d1;
        }

        #PanalNumber {
            border: 2px solid #d1d1d1;
        }

        #Type {
            border: 2px solid #d1d1d1;
        }

        #carCarLicenseNo {
            border: 2px solid #d1d1d1;
        }
        #TrxType {
            border: 2px solid #d1d1d1;
        }
    </style>
    ViewBag.Title = "";
    ApplicationDbContext db = new ApplicationDbContext();

    //SelectList ItemList = new SelectList(db.Item.Where(a => a.IsDeleted == false), "Id", "ItemNameAr");
    //SelectList ItemCategoriesList = new SelectList(db.Itemgroups.Where(a => a.IsDeleted == false), "Id", "ItemgroupsName");
    //SelectList UnitList = new SelectList(db.Unit.Where(a => a.IsDeleted == false), "Id", "UnitName");
    SelectList MachineType = new SelectList(db.MachineType, "Id", "Name");
    SelectList Service = new SelectList(db.Service_Tbl.Where(a => a.IsDeleted == false), "ServiceId", "ServiceName");


    SelectList CarsList = new SelectList(db.Cars.Where(a => a.IsDeleted == false), "Id", "PanelNo");

    SelectList EmployeeList = new SelectList(db.Employee.Where(a => a.IsDeleted == false), "Id", "EmployeeNameAr");
    SelectList VendorsList = new SelectList(db.Vendor.Where(a => a.IsDeleted == false), "Id", "Name");
    int CurrentBranch = ViewBag.DefultBranch;
    //var BranchName = db.Branches.SingleOrDefault(a => a.Id == CurrentBranch);
    //SelectList BranchList = new SelectList(db.Branches.Where(a => a.IsDeleted == false && a.Id == BranchName.Id), "Id", "BranchesName", BranchName.Id);
    //SelectList storesInformationsList = new SelectList(db.StoresInformations.Where(a => a.IsDeleted == false), "Id", "Name");
    //SelectList InternalDepartments = new SelectList(db.InternalDepartments.Where(a => a.IsDeleted == false), "Id", "Name");
    //SelectList StoresKeepers = new SelectList(db.StoresKeepers.Where(a => a.IsDeleted == false), "Id", "Name");

    //SelectList PaymentTypeList = new SelectList(db.PaymentType.Where(a => a.IsDeleted == false), "Id", "PaymentTypeName");

    //SelectList PurchaseINVTypeList = new SelectList(db.PurchaseINVType.Where(a => a.IsDeleted == false), "Id", "PurchaseINVTypeName");
    //var PurSetting = db.InvoicesSettings.FirstOrDefault(a => a.FormName == "Purchases");
    string Notes = "";
    bool edit = false;
    var prefix = "";
    //if (PurSetting != null)
    //{

    //    Notes = PurSetting.Notes;
    //    edit = PurSetting.Editable;
    //    prefix = PurSetting.IDPrefix;
    //}
}

<style>
    .DateChange::-webkit-input-placeholder {
        text-align: center
    }

    .row {
        margin-bottom: 8px;
    }

    .button.button-small {
        height: 30px;
        line-height: 30px;
        padding: 0px 10px;
    }

    td input[type=text],
    td select {
        display: block;
        width: 100%;
        font-size: 14px;
        padding: 0px 15px;
        height: 32px;
        margin: 0;
        font-weight: 400;
        line-height: 1.5;
        color: #666666;
        border: 1px solid #ced4da;
        border-radius: 0.25rem;
        -webkit-transition: border-color .15s ease-in-out, -webkit-box-shadow .15s ease-in-out;
        transition: border-color .15s ease-in-out, -webkit-box-shadow .15s ease-in-out;
        transition: border-color .15s ease-in-out, box-shadow .15s ease-in-out;
        transition: border-color .15s ease-in-out, box-shadow .15s ease-in-out, -webkit-box-shadow .15s ease-in-out;
    }

        td input[type=text]:focus,
        td select:focus {
            border-color: #6777ef;
        }

    th:last-child {
        text-align: right;
    }

    td:last-child {
        text-align: right;
    }

        td:last-child .button {
            width: 30px;
            height: 30px;
            text-align: center;
            padding: 0px;
            margin-bottom: 0px;
            margin-right: 5px;
            background-color: #FFF;
        }

            td:last-child .button .fa {
                line-height: 30px;
                width: 30px;
            }

    #PurchaseINVNo, #RowsCount, #TotaleItemDis, #TotalBeforeDis, #Residual, #TotalNet, #TrxSerial {
        border: 2px solid #ebebeb;
    }
</style>
<div class="invoice-container">
    <!--<div class="row heder_title">
        <div class="col-6">
            <h3 class="blockquote">@DataMapping.Resources.Resource.PurchaseINV</h3>
        </div>
        <div class="col-6 text-left" style="display: -webkit-inline-box; margin-right:1000px">
            <a href="#" id="submit" class="btn btn-icon icon-left btn-info">
                @DataMapping.Resources.Resource.save <i class="fa fa-save" aria-hidden="true"></i>
            </a>-->
    @*<a href="#" class="btn btn-outline-secondary">
            طباعة <i class="fas fa-print"></i>
        </a>*@
    <!--@using (Html.BeginForm("PrintDataRDLC", "PurchaseINV"))
            {
                <button formtarget="_blank" type="submit" class="btn btn-outline-secondary" style="background-color:white; color:darkgreen;border-width:2px">

                    @DataMapping.Resources.Resource.Print  <i class="fa fa-print" aria-hidden="true"></i>

                </button>
            }
            <a id="ADD" href="#" class="btn btn-icon icon-left success_butn" data-toggle="modal">
                @DataMapping.Resources.Resource.Add <i class="fa fa-plus" aria-hidden="true"></i>
            </a>
        </div>
    </div>-->
    <div class="row heder_title">
        <div class="col-6">
            <h3 class="blockquote">سند صرف زيوت وفلاتر وغسيل</h3>
        </div>
        <div class="col-6 text-left" style="display: -webkit-inline-box; direction:ltr">
            <a href="~/ServicesTrx/Index" id="back" class="btn btn-icon icon-left btn-outline-warning" @*data-toggle="modal"*@>
                رجوع <i class="fa fa-chevron-left" aria-hidden="true"></i>
            </a>
            @*<a href="#" class="btn btn-outline-secondary">
                    طباعة <i class="fas fa-print"></i>
                </a>*@
            @using (Html.BeginForm("PrintDataRDLC", " ServicesTrx"))
            {
                <button formtarget="_blank" type="submit" class="btn btn-outline-secondary">
                    طباعة  <i class="fa fa-print" aria-hidden="true"></i>
                </button>
            }
        </div>
    </div>
    <input type="number" id="change" hidden>
    <div class="row">
        <div class="col-12">
            <div class="accordion" id="accordionExample">
                <div class="card">
                    <div class="row card-header" id="headingOne">
                        <h2 class="col-2 mb-0 text-right">
                            <button class="btn btn-link btn-block text-left" type="button" data-toggle="collapse" data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                            </button>
                        </h2>
                        <div class="col-10 text-left">
                            <button class="btn btn-link btn-block no_hover_btn text-left" type="button" data-toggle="collapse" data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                                <i class="fas fa-chevron-down"></i>
                            </button>
                        </div>
                    </div>
                    <div id="collapseOne" class="collapse show" aria-labelledby="headingOne" data-parent="#accordionExample">
                        <div class="card-body" style="height:300px;">
                            <div class="row">
                                <div class="col-6">
                                    <div class="card-layout">
                                        <div class="mb-2 row">
                                            <label class="col-sm-2 col-form-label"> مسلسل</label>
                                            <div class="col-sm-4">

                                                @Html.TextBoxFor(a => a.TrxType, new { Value = ViewBag.autoCode, @id = "TrxType", @class = "form-control", @readonly = "readonly" })
                                                @*}*@
                                            </div>

                                            <label class="col-sm-2 col-form-label">تاريخ الاستلام</label>
                                            <div class="col-sm-4">
                                                @Html.TextBoxFor(a => a.Date, new { @id = "Date", @class = "DateChange form-control", type = "date", Value = ViewBag.autoDate })
                                            </div>
                                            @*<label class="col-sm-2 col-form-label"> السنة</label>

            <div class="col-sm-4">
                @Html.TextBoxFor(a => a.Year, new { @id = "Year", @class = "DateChange form-control", type = "date", Value = ViewBag.autoDate })
            </div>*@
                                        </div>

                                        <div class="mb-2 row">


                                            <label class="col-sm-2 col-form-label">   المركبة <span style="color:red">*</span></label>
                                            <div class="col-sm-10">
                                                @Html.DropDownList("CarsList", CarsList, "... أختر  ...", new { @id = "Serial", @class = "BranchList form-control", @readonly = "readonly" })

                                                @*@Html.TextBoxFor(a => a.Serial, new { @id = "Serial", @class = " form-control" })*@
                                            </div>





                                        </div>
                                        <div class="mb-2 row">


                                            <label class="col-sm-2 col-form-label"> السائق<span style="color:red">*</span></label>
                                            <div class="col-sm-10">
                                                <input type="text" id="DriverID" name="lname" class=" form-control">

                                                @*@Html.TextBoxFor(a => a.Attachments, new { @id = "Attachments", @class = " form-control" })*@
                                            </div>






                                        </div>
                                        <div class="mb-2 row">


                                            <label class="col-sm-2 col-form-label">  الادارة<span style="color:red">*</span></label>
                                            <div class="col-sm-10">
                                                <input type="text" id="Manage" name="lname" class=" form-control">

                                                @*@Html.TextBoxFor(a => a.Attachments, new { @id = "Attachments", @class = " form-control" })*@
                                            </div>





                                        </div>

                                        <div class="mb-2 row">

                                            <label class="col-sm-2 col-form-label"> النوع </label>
                                            <div class="col-sm-4">
                                                @Html.TextBoxFor(a => a.Type, new { @id = "Type", @class = " form-control", @readonly = "readonly" })
                                            </div>
                                            <label class="col-sm-2 col-form-label">    رقم اللوحة<span style="color:red">*</span></label>
                                            <div class="col-sm-4">
                                                <input type="text" id="PanalNumber" name="lname" class=" form-control" readonly="readonly">
                                                @*@Html.TextBoxFor(a => a.Attachments, new { @id = "Attachments", @class = " form-control" })*@
                                            </div>





                                        </div>
                                        <div class="mb-2 row">

                                            <label class="col-sm-2 col-form-label">   رقم الاستمارة  </label>
                                            <div class="col-sm-4">

                                                <input type="text" id="carCarLicenseNo" name="lname" class=" form-control" readonly="readonly">

                                                @*@Html.TextBoxFor(a => a.PagesCount, new { @id = "PagesCount", @class = " form-control" })*@
                                            </div>
                                         





                                        </div>










                                    </div>
                                </div>

                                <div class="col-6">
                                    <div class="card-layout" style="height:auto">
                                        <div class="mb-2 row">

                                            <label class="col-sm-2 col-form-label">  تاريخ التنبية  </label>
                                            <div class="col-sm-4">
                                                @*@Html.TextBoxFor(a => a.Date, new { @id = "Date", @class = "DateChange form-control", type = "date", Value = ViewBag.autoDate })*@

                                                @Html.TextBoxFor(a => a.AlertDate, new { @id = "AlertDate", @class = " form-control", type = "date", Value = ViewBag.autoDate })
                                            </div>

                                            <label class="col-sm-2 col-form-label"> نوع المركبة </label>
                                            <div class="col-sm-4">
                                                @Html.DropDownList("MachineType", MachineType, "... أختر  ...", new { @id = "MachineType", @class = "BranchList form-control" })
                                            </div>





                                        </div>
                                        <div class="mb-2 row">
                                            <label class="col-sm-2 col-form-label"> ايام التنبية</label>
                                            <div class="col-sm-4">
                                                <input type="text" id="AlertDays" name="AlertDays" class=" form-control">
                                                @*@Html.TextBoxFor(a => a.AlertDays, new { @id = "AlertDays", @class = " form-control" })*@
                                            </div>
                                            <label class="col-sm-2 col-form-label">    الفرق  </label>
                                            <div class="col-sm-4">
                                                <input type="text" id="" name="lname" class=" form-control">

                                                @*@Html.TextBoxFor(a => a.PagesCount, new { @id = "PagesCount", @class = " form-control" })*@
                                            </div>






                                        </div>

                                        <div class="mb-2 row">

                                            <label class="col-sm-2 col-form-label"> القراءة الحالية </label>
                                            <div class="col-sm-4">
                                                @Html.TextBoxFor(a => a.CurrentReading, new { @id = "CurrentReading", @class = " form-control" })
                                            </div>
                                            <label class="col-sm-2 col-form-label"> القراءة السابقة<span style="color:red">*</span></label>
                                            <div class="col-sm-4">
                                                @Html.TextBoxFor(a => a.PreviousReading, new { @id = "PreviousReading", @class = " form-control", @readonly = "readonly" })
                                            </div>





                                        </div>
                                        <div class="mb-2 row">


                                            <label class="col-sm-2 col-form-label">     اخر قراءة<span style="color:red">*</span></label>
                                            <div class="col-sm-4">
                                                <input type="text" id="PreviousReading" name="lname" class=" form-control" readonly="readonly">

                                                @*@Html.TextBoxFor(a => a.Attachments, new { @id = "Attachments", @class = " form-control" })*@
                                            </div>





                                        </div>
                                        <div class="mb-2 row">

                                            <label class="col-sm-2 col-form-label">  تغيير زيت كل  </label>
                                            <div class="col-sm-4">
                                                @Html.TextBoxFor(a => a.ReplaceOil, new { @id = "ReplaceOil", @class = " form-control" })
                                            </div>
                                            <label class="col-sm-2 col-form-label">  التغيير القائم عند<span style="color:red">*</span></label>
                                            <div class="col-sm-4">
                                                @Html.TextBoxFor(a => a.SMS_Sent, new { @id = "SMS_Sent", @class = " form-control" })
                                            </div>





                                        </div>


                                        <label class="col-sm-4 col-form-label">     الحد المسموح لتغيير الزيت <span style="color:red">*</span></label>
                                        <div class="col-sm-6">
                                            <input type="text" id="" name="lname" class=" form-control">

                                            @*@Html.TextBoxFor(a => a.Attachments, new { @id = "Attachments", @class = " form-control" })*@
                                        </div>





                                    </div>


                                </div>

                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-12">
            <div class="table-responsive">
                <table id="OrdersItems" class="table table-striped table-bordered table-hover" style="width:100%;">
                    <thead>
                        <tr>
                            <th class="th_width_3">كود  الخدمة</th>
                            @*<th class="th_width_3" hidden></th>*@
                            <th>اسم الخدمة</th>

                            <th class="th_width_2">@DataMapping.Resources.Resource.Quantity</th>
                            @*<th class="th_width_2">@DataMapping.Resources.Resource.Price</th>
                                <th class="th_width_10">@DataMapping.Resources.Resource.Total</th>*@
                            @*<th class="th_width_3">@DataMapping.Resources.Resource.DisPer</th>
                                <th class="th_width_3">@DataMapping.Resources.Resource.DisVal</th>
                                <th class="th_width_3">@DataMapping.Resources.Resource.Net</th>*@



                            <th class="th_width_3">@DataMapping.Resources.Resource.Delete</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr id="MainRow">
                            <td>
                                <input type="number" id="ItemNumber" class="ItemNumber form-control" readonly>

                            </td>
                            @*<td>


                                    <input type="number" id="Qty" class="Qty form-control" value="">

                                </td>*@
                            <td>
                                @Html.DropDownList("Service", Service, "اختر الخدمة", new { @id = "Service", @class = "ItemListCLS form-control select2" })

                                @*@Html.DropDownList("ItemList", null, "اختر الصنف", new { @id = "ItemList", @class = "ItemListCLS form-control select2" })*@


                            </td>
                            @*<td>
                                    @Html.DropDownList("UnitList", null, "اختر الوحدة", new { @id = "UnitList", @class = "UnitList form-control select2" })


                                </td>*@
                            <td>
                                <input type="number" id="Qty" class="Qty form-control" value="1">
                            </td>
                            @*<td>
                                    <input type="text" id="Price" class="Price form-control" value="0">
                                </td>
                                <td>
                                    <span id="Total" class="Total"></span>
                                </td>*@
                            @*<td>
                                    <input type="number" id="Disper" class="Disper form-control" value="0">
                                </td>
                                <td>
                                    <input type="number" id="DisValue" class="DisValue form-control" value="0">
                                </td>
                                <td>
                                    <span id="Net" class="Net"></span>

                                </td>*@



                            <td>
                                <a id="addd" class="deleteItem btn btn-icon btn-outline-info" data-toggle="modal" hidden>
                                    @*<i class="fas fa-check"></i>*@
                                    <i class="fas fa-plus-circle success"></i>
                                </a>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-12">
            <button id="addRowService" class="btn btn-icon icon-left success_butn add-row"><i class="fa fa-plus"></i>إضافة صف</button>
        </div>
    </div>

    <!--<div class="row">
        <div class="col-12">
            <div class="card invoice_total" style="background-color: white; color: black;">
                <div class="card-body" style="">
                    <div class="row">


                        <label class="col-sm-2 col-form-label text-right" style="font-size: 14px; font-weight: bold">نسبة الخصم الاجمالية</label>
                        <div class="col-sm-4">
                            <input type="number" id="TotalDisper" class="form-control TotalDisper" />
                        </div>
                        <label class="col-sm-2 col-form-label text-right" style="font-size: 14px; font-weight: bold;">اجمالي قيمة الفاتورة</label>
                        <div class="col-sm-4">
                            <span id="TotalBeforeDis" class="TotalBeforeDis"></span>
                        </div>
                    </div>
                    <div class="divider"></div>
                    <div class="row">



                        <label class="col-sm-2 col-form-label text-right" style="font-size: 14px; font-weight: bold">قيمة الخصم الاجمالية</label>
                        <div class="col-sm-4">
                            <input type="number" id="TotalDis" class="form-control TotalDis" />
                        </div>
                        <label class="col-sm-2 col-form-label text-right" style="font-size: 14px; font-weight: bold;text-align:right">المبلغ المتبقى</label>
                        <div class="col-sm-4">
                            <span id="Residual" class="Residual"></span>
                        </div>

                    </div>
                    <div class="divider"></div>
                    <div class="row">-->
    @*<label class="col-sm-2 col-form-label text-right" style="font-size: 14px; font-weight: bold">المبلغ المدفوع</label>
        <div class="col-sm-4">
            <input type="number" id="Payed" class="form-control Payed" />
        </div>*@

    <!--<label class="col-sm-2 col-form-label text-right" style="font-size: 14px; font-weight: bold; text-align:right">صافي قيمة الفاتورة</label>
                        <div class="col-sm-4">
                            <span id="TotalNet" class="TotalNet"></span>
                        </div>


                    </div>
                    <div class="divider"></div>
                </div>
            </div>
        </div>
    </div>-->
</div>
<div class="row">
    <div class="col-12">


        <div class="accordion" id="accordionExampleee">
            <div class="card">
                <div class="row card-header" id="headingOneee">
                    <h3 class="col-2 mb-0 text-right">
                        <button class="btn btn-link btn-block" type="button" data-toggle="collapse" data-target="#collapseOneee" aria-expanded="true" aria-controls="collapseOneee">
                            @DataMapping.Resources.Resource.Notes
                        </button>
                    </h3>
                    <div class="col-10 text-left">
                        <button class="btn btn-link btn-block no_hover_btn text-left" type="button" data-toggle="collapse" data-target="#collapseOneee" aria-expanded="true" aria-controls="collapseOneee">
                            <i class="fas fa-chevron-down"></i>
                        </button>
                    </div>
                </div>
                <div id="collapseOneee" class="collapse show" aria-labelledby="headingOneee" data-parent="#accordionExampleee">
                    <div class="card-body">
                        <div class="row">
                            <div class="form-group col-12">
                                <textarea name="myTextarea" id="myTextareaNotes">@Notes</textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="accordion" id="accordionExampleeee">
            <div class="card">
                <div class="row card-header" id="headingOneeee">
                    <h3 class="col-2 mb-0 text-right">
                        <button class="btn btn-link btn-block" type="button" data-toggle="collapse" data-target="#collapseOneeee" aria-expanded="true" aria-controls="collapseOneeee">
                            المرفقات
                        </button>
                    </h3>
                    <div class="col-10 text-left">
                        <button class="btn btn-link btn-block no_hover_btn text-left" type="button" data-toggle="collapse" data-target="#collapseOneeee" aria-expanded="true" aria-controls="collapseOneeee">
                            <i class="fas fa-chevron-down"></i>
                        </button>
                    </div>
                </div>
                <div id="collapseOneeee" class="collapse show" aria-labelledby="headingOneeee" data-parent="#accordionExampleeee">
                    <div class="card-body">
                        <form action="/file-upload" class="dropzone" id="my-awesome-dropzone"></form>
                        <button id="submit-files" class="btn btn-secondary" style="margin-top:16px;">رفع</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-12">
        <a href="#" id="submit" class="btn btn-icon icon-left info_butn">
            @DataMapping.Resources.Resource.save <i class="fa fa-save" aria-hidden="true"></i>
        </a>
    </div>
</div>
@section ModelPopup{
    <div class="modal fade" id="createModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true" style="width:85%">
        <div class="modal-dialog modal-xl modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalCenterTitle">@DataMapping.Resources.Resource.AddItem</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" style="padding-bottom: 0px !important;">
                    <div class="row">
                        <div class="table-responsive">
                            <table style="table-layout: fixed !important" class="table table-striped table-bordered table-hover" style="width:100%;">

                                <tbody></tbody>
                            </table>
                            <table id="TbItem" style="table-layout: fixed !important" class="table table-striped table-bordered table-hover" style="width:100%;">
                                <thead>
                                    <tr>
                                        <th class="th_width_3">@DataMapping.Resources.Resource.ItemNo</th>
                                        <th class="th_width_14">@DataMapping.Resources.Resource.ItemGroup</th>
                                        <th class="th_width_14">@DataMapping.Resources.Resource.ItemName</th>
                                        <th class="th_width_9">@DataMapping.Resources.Resource.unit</th>
                                        <th class="th_width_5">@DataMapping.Resources.Resource.Quantity</th>
                                        @*<th class="th_width_8">@DataMapping.Resources.Resource.Price</th>
                                            <th class="th_width_8">@DataMapping.Resources.Resource.Total</th>
                                            <th class="th_width_5">@DataMapping.Resources.Resource.DisPer</th>
                                            <th class="th_width_5">@DataMapping.Resources.Resource.DisVal</th>
                                            <th class="th_width_8">@DataMapping.Resources.Resource.Net</th>

                                            <th class="th_width_5">@DataMapping.Resources.Resource.Balance</th>
                                            <th class="th_width_3">@DataMapping.Resources.Resource.ItemCostt</th>*@
                                        <th class="th_width_3">ادراج</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr id="MainRow">
                                        <td>
                                            <input type="number" id="ItemNumber" class="ItemNumber form-control" readonly>

                                        </td>
                                        @*<td id="GroupHide">
                                                <div>
                                                    @Html.DropDownList("ItemCategoriesList", ItemCategoriesList, "اختر الكل", new { @id = "ItemCategoriesList", @class = "ItemCategoriesList form-control select2" })

                                                </div>

                                            </td>*@
                                        <td>
                                            @Html.DropDownList("Service", Service, "اختر الخدمة", new { @id = "ItemList", @class = "ItemListCLS form-control select2" })

                                            @*@Html.DropDownList("ItemList", null, "اختر الصنف", new { @id = "ItemList", @class = "ItemListCLS form-control select2" })*@


                                        </td>
                                        @*<td>
                                                @Html.DropDownList("UnitList", null, "اختر الوحدة", new { @id = "UnitList", @class = "UnitList form-control select2" })


                                            </td>*@
                                        <td>
                                            <input type="number" id="Qty" class="Qty form-control" value="1">
                                        </td>
                                        @*<td>
                                                <input type="text" id="Price" class="Price form-control" value="0">
                                            </td>
                                            <td>
                                                <span id="Total" class="Total"></span>
                                            </td>
                                            <td>
                                                <input type="number" id="Disper" class="Disper form-control" value="0">
                                            </td>
                                            <td>
                                                <input type="number" id="DisValue" class="DisValue form-control" value="0">
                                            </td>
                                            <td>
                                                <span id="Net" class="Net"></span>

                                            </td>*@

                                        @*<td>
                                                <input type="number" id="ItemBalance" class="form-control" readonly>
                                            </td>
                                            <td>
                                                <input type="number" id="ItemCostt" class="ItemCostt form-control" readonly>

                                            </td>*@
                                        <td>
                                            <a id="add" class="deleteItem btn btn-icon btn-outline-info" data-toggle="modal">
                                                @*<i class="fas fa-check"></i>*@
                                                <i class="fas fa-plus-circle success"></i>
                                            </a>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="mb-2 row">
                        <div class="col-12 text-right">
                            <button type="button" id="toggle" class="btn btn-primary"> تفاصيل الصنف </button>
                        </div>
                    </div>

                    <div class="row" id="showdetails">
                        <div class="card-layout">
                            <div class="col-12">
                                <div class="mb-2 row">
                                    <label class="col-sm-2 col-form-label text-center">أخر سعر شراء</label>
                                    <div class="col-sm-2">
                                        <span class="pop_span"></span>
                                    </div>

                                    <label class="col-sm-2 col-form-label text-center">أقل سعر شراء</label>
                                    <div class="col-sm-2">
                                        <span class="pop_span"></span>
                                    </div>

                                    <label class="col-sm-2 col-form-label text-center">أعلى سعر شراء</label>
                                    <div class="col-sm-2">
                                        <span class="pop_span"></span>
                                    </div>
                                </div>

                                <div class="row">
                                    <label class="col-sm-2 col-form-label text-center">أخر سعر شراء من نفس المورد</label>
                                    <div class="col-sm-2">
                                        <span class="pop_span"></span>
                                    </div>

                                    <label class="col-sm-2 col-form-label text-center">التاريخ</label>
                                    <div class="col-sm-2">
                                        <span class="pop_span"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-whitesmoke br">
                    <div class="row">
                        <div class="col-12 text-left">
                            <button type="button" class="btn btn-danger" data-dismiss="modal">@DataMapping.Resources.Resource.Close</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
}
@section JavaScriptSection{
    <script src="~/Scripts/ERPScript/ServiceTrx.js"></script>
    <script src="~/Scripts/ERPScript/ItemCalculatejs.js"></script>


    <script src="~/Scripts/DataPicker/jquery-ui.min.js"></script>
    @*datepicker Osama Sadek*@
    <link href="https://ajax.aspnetcdn.com/ajax/jquery.ui/1.10.4/themes/start/jquery-ui.css" rel="stylesheet" />

    <link href="~/Scripts/DataPicker/jquery-ui.min.css" rel="stylesheet" />

    <script type="text/javascript" language="javascript">

        $("input").keyup(function () {
            $("#change").val(1);
        })
        $("#back").click(function () {
            //alert($("#change").val());
            if ($("#change").val() == 1) {

                window.onbeforeunload = function () {
                    var Ans = confirm("لقد تم تغيير البيانات هل تريد الحفظ");
                    if (Ans == true) {
                        return true;
                        toastr.warning('هذه السيارة مسلمة لموظف ');
                    }

                    else
                        return false;
                };
            }


        });

        $(document).ready(function () {
            $("#change").val(0);
        })
    </script>


    <script>


        // اظهار نوع السيارة
        function loadItem() {
            var itemId = $("#Serial").val();

            getCarType(itemId);
        }
        $("#Serial").change(function () {
            var itemId = $("#Serial").val();
            $.ajax({
                async: true,
                type: 'GET',
                dataType: 'JSON',
                contentType: 'application/json; charset=utf-8',
                data: { itemId: itemId },
                url: '/ServicesTrx/getCarType',
                success: function (data) { $("#Type").val(data) },
                error: function () { alert('There is some problem to get the unit price.') }
            });
        })
        //اظهار رقم اللوحة
        function loadItem() {
            var itemId = $("#Serial").val();

            getCarType(itemId);
        }
        $("#Serial").change(function () {
            var itemId = $("#Serial").val();
            $.ajax({
                async: true,
                type: 'GET',
                dataType: 'JSON',
                contentType: 'application/json; charset=utf-8',
                data: { itemId: itemId },
                url: '/ServicesTrx/getCarpanalNo',
                success: function (data) { $("#PanalNumber").val(data) },
                error: function () { alert('There is some problem to get the unit price.') }
            });
        })

        // اظهار رقم الاستمارة
        function loadItem() {
            var itemId = $("#Serial").val();

            getCarType(itemId);
        }
        $("#Serial").change(function () {
            var itemId = $("#Serial").val();
            $.ajax({
                async: true,
                type: 'GET',
                dataType: 'JSON',
                contentType: 'application/json; charset=utf-8',
                data: { itemId: itemId },
                url: '/ServicesTrx/getCarLicenseNo',
                success: function (data) { $("#carCarLicenseNo").val(data) },
                error: function () { alert('There is some problem to get the unit price.') }
            });
        })


        // اظهار رقم القراء السابقة للسيارة

        function loadItem() {
            var itemId = $("#Serial").val();

            getCarType(itemId);
        }
        $("#Serial").change(function () {
            var itemId = $("#Serial").val();
            $.ajax({
                async: true,
                type: 'GET',
                dataType: 'JSON',
                contentType: 'application/json; charset=utf-8',
                data: { itemId: itemId },
                url: '/ServicesTrx/getPreviousReading',
                success: function (data) { $("#PreviousReading").val(data) },
                error: function () { alert('There is some problem to get the unit price.') }
            });
        })

        //اظهار رقم الخدمة

        function loadItem() {
            var itemId = $("#Service").val();

            getServiceId(itemId);
        }
        $("#Service").change(function () {
            var itemId = $("#Service").val();
            $.ajax({
                async: true,
                type: 'GET',
                dataType: 'JSON',
                contentType: 'application/json; charset=utf-8',
                data: { itemId: itemId },
                url: '/ServicesTrx/getServiceId',
                success: function (data) { $("#ItemNumber").val(data) },
                error: function () { alert('There is some problem to get the ServiceId.') }
            });
        })


        $(document).ready(function () {
            $("#Serial").prop("disabled", true);
        })
        $("#Serial").prop("disabled", true);
        $("#MachineType").change(function () {
            $("#Serial").prop("disabled", false);
            $.get("/ServicesTrx/GetCarOrEquipment/", { itemId: $("#MachineType").val() }, function (data) {
                $("#Serial").empty();
                $("#Serial").append("<option>اختر</option>")

                $.each(data, function (index, row) {
                    $("#Serial").append("<option value='" + row.Id + "'>" + row.PanelNo + "</option>")
                });
            });
        })

    </script>
    <script>
        $(document).ready(function () {


            var date = new Date();

            var day = date.getDate();
            var month = date.getMonth() + 1;
            var year = date.getFullYear();

            if (month < 10) month = "0" + month;
            if (day < 10) day = "0" + day;

            var today = year + "-" + month + "-" + day;
            $("#DocDate").attr("value", today);

        });
        $(document).ready(function () {


            var date = new Date();
            var date = new Date();

            var day = date.getDate();
            var month = date.getMonth() + 1;
            var year = date.getFullYear();

            if (month < 10) month = "0" + month;
            if (day < 10) day = "0" + day;

            var today = year + "-" + month + "-" + day;
            $("#Date").attr("value", today);

        });
        $(document).ready(function () {


            var date = new Date();

            var day = date.getDate();
            var month = date.getMonth() + 1;
            var year = date.getFullYear();

            if (month < 10) month = "0" + month;
            if (day < 10) day = "0" + day;

            var today = year + "-" + month + "-" + day;
            $("#AlertDate").attr("value", today);

        });



    </script>


    <script>
        var toggle = document.getElementById("toggle");
        var content = document.getElementById("showdetails");

        toggle.addEventListener("click", function () {
            showdetails.style.display = (content.dataset.toggled ^= 1) ? "block" : "none";
        });


    </script>
    <script>
        $('#ItemList').change(function () {
            //اخفاء تفاصيل الصنف عند تغيير اختيار الصنف
            $("#showdetails").hide();

        });
    </script>

    @*فلتره الاصناف بناءا علي  فئات الاصناف*@







    @* //تفريغ الحقول بعد اغلاق البوب اب*@

    <script>
        //تفريغ الحقول بعد اغلاق البوب اب




    </script>



    <script>

        $("#Serial").change(function () {
          

            //GetDate();
            //GetReceiptDate();
            //GetData();

            //$("#DaysCount").val("")
    




            //$.get("/ServicesTrx/GetLastTRX", { ID: $("#Serial").val() }, function (data) {

            //    if (data != null) {
            //        if (data == 2) {
            //            toastr.warning(' هذة السيارة تم رجوعها وهى حاليا غير مسلمة لموظف ');
            //        }
            //        else if (data == 1) {

            //            toastr.warning('هذه السيارة ليس لها محضر تسليم   ');
            //            if ($("#CarDriverNo" == null)) {
            //                $("#submit").attr("disabled", true);
            //            }


            //        }
            //        else {
            //            $.each(data, function (index, row) {


            //                $("#AlertDays").val(row.DaysCount)
            //                //$("#SideName").val(row.SideName)
            //                //$("#CarDriverNo").val(row.Serial)
            //                //$("#Notes").val(row.Notes)
            //                //$("#TimeId").val(row.Time)
            //               /* $("#DrivId").val(row.DriverID)*/


            //            });

            //        }


            //    }

            //});

            

            //اسم السائق والتلفون

         
            $("#DriverID").val("")
            $.get("/CarDelivery/GetDriversInfo", { ID: $("#Serial").val() }, function (data) {

                $.each(data, function (index, row) {

                    $("#Mobile").val(row.Phone);
                    $("#DriverID").val(row.DriverName);


                });
            });

            $("#Manage").val("");

            // الادارة
            $.get("/CarDelivery/GetDriverManage", { ID: $("#Serial").val() }, function (data) {


                if (data != 1) {
                    $.each(data, function (index, row) {

                        $("#Manage").val(row.BranchesName);

                    });
                }

                else {

                }


            });
        });

        $(document).ready(function () {


            var date = new Date();

            var day = date.getDate();
            var month = date.getMonth() + 1;
            var year = date.getFullYear();

            if (month < 10) month = "0" + month;
            if (day < 10) day = "0" + day;

            var today = year + "-" + month + "-" + day;
            $("#PurchaseINVDate").attr("value", today);

        });

    </script>







}

